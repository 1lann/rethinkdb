desc: Tests insertion with a modifier function
table_variable_name: tbl
tests:

  - js: tbl.modifierCreate(function(a, b) { return b.merge({'num':1})})
    py: tbl.modifier_create(lambda a,b: b.merge({'num':1}))
    rb: tbl.modifier_create(lambda { |a,b| b.merge({'num':1})})
    ot: partial({'created': 1 })

  - cd: tbl.insert({'id': 1})
    ot: partial({'inserted':1, 'errors':0})

  - cd: tbl
    ot: [{"id": 1, "num": 1}]

  - cd: tbl.modifier_drop()
    ot: partial({'dropped': 1 })

  - js: tbl.modifierCreate(function(a, b) { return b.merge({'num':2})})
    py: tbl.modifier_create(lambda a,b: b.merge({'num':2}))
    rb: tbl.modifier_create(lambda { |a,b| b.merge({'num':2})})
    ot: partial({'created': 1 })

  - cd: tbl.update({"blah":2})
    ot: partial({'replaced':1, 'errors':0})

  - cd: tbl
    ot: [{"id":1, "blah":2, "num":2}]

  - cd: tbl.modifier_drop()
    ot: partial({'dropped': 1 })

  - cd: tbl.modifier_drop()
    ot: err_regex('ReqlOpFailedError', 'No modifier function exists on table `[a-zA-Z0-9_]+.[a-zA-Z0-9_]+`[.]', [0])


  - js: tbl.modifierCreate(function(b) { return 1;})
    py: tbl.modifier_create(lambda a: 1)
    rb: tbl.modifier_create(lambda { |b| 1})
    ot: err('ReqlQueryLogicError', 'Modifier functions must expect 2 arguments.')

  - js: tbl.modifierCreate(function(b) { return r.js(1);})
    py: tbl.modifier_create(lambda a: r.js(1))
    rb: tbl.modifier_create(lambda { |b| r.js(1)})
    ot: err('ReqlQueryLogicError', 'Could not prove function deterministic.  Modifier functions must be deterministic.')

  - js: tbl.modifierCreate(function(a, b) { return null;})
    py: tbl.modifier_create(lambda a,b: null)
    rb: tbl.modifier_create(lambda { |a,b| null})
    ot: partial({'created': 1 })

  - js: tbl.modifierCreate(function(a, b) { return b.merge({'num':2})})
    py: tbl.modifier_create(lambda a,b: b.merge({'num':2}))
    rb: tbl.modifier_create(lambda { |a,b| b.merge({'num':2})})
    ot: err_regex('ReqlOpFailedError', 'A modifier function already exists on table `[a-zA-Z0-9_]+.[a-zA-Z0-9_]+`[.]', [0])

  - cd: tbl.insert({})
    ot: partial({'first_error': 'Modifier function returned NULL value.'})


