## Customize the test machine
machine:

  timezone:
    America/Los_Angeles # Set the timezone

  # Set version of node to use
  node:
    version: 5.7.0

  post:
  - source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
  - wget -qO- https://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
  - sudo apt-get update -o Dir::Etc::sourcelist="/etc/apt/sources.list.d/rethinkdb.list" -o Dir::Etc::sourceparts="-" -o APT::Get::List-Cleanup="0"
  - sudo apt-get install rethinkdb


## Set artifacts
# general:
#   artifacts:

## Customize dependencies
dependencies:
  override:
    # Stop default services
    - sudo service redis-server stop
    - sudo service postgresql stop
    - sudo service mysql stop

    # Prepare for client tests
    - sudo apt-get update
    - sudo apt-get install python-dev libffi-dev libssl-dev
    - export LC_ALL="en_US.UTF-8"; export LC_CTYPE="en_US.UTF-8"; sudo dpkg-reconfigure locales
    - sudo pip install urllib3[secure] --upgrade --ignore-installed
    - sudo pip install tornado --upgrade --ignore-installed
    - sudo pip install twisted --upgrade --ignore-installed
    - sudo pip install pyopenssl --upgrade --ignore-installed
    - sudo pip install gevent --upgrade --ignore-installed
    - sudo npm install -g mocha
    - sudo gem install eventmachine


## Customize test commands
test:
  override:
    # Run client tests
    - ./test-runner -i js5:
        parallel: true
        pwd: test
    - ./test-runner -i py2.7:
        parallel: true
        pwd: test
    - ./test-runner -i py3.5:
        parallel: true
        pwd: test
    - ./test-runner -i rb2.3:
        parallel: true
        pwd: test
